version: '3.8'

services:
  chroma:
      image: ghcr.io/chroma-core/chroma:latest
          ports:
                - "8000:8000"
                    environment:
                          CHROMA_DB_IMPL: duckdb
                              volumes:
                                    - chroma_data:/chroma/chroma
                                        healthcheck:
                                              test: ["CMD", "curl", "-f", "http://localhost:8000/api/v1/heartbeat"]
                                                    interval: 5s
                                                          timeout: 3s
                                                                retries: 5

                                                                  bot:
                                                                      build: .
                                                                          ports:
                                                                                - "5000:5000"
                                                                                    depends_on:
                                                                                          chroma:
                                                                                                  condition: service_healthy
                                                                                                      environment:
                                                                                                            CHROMA_HOST: chroma
                                                                                                                  CHROMA_PORT: 8000
                                                                                                                        OPENAI_API_KEY: ${OPENAI_API_KEY}
                                                                                                                              ANTHROPIC_API_KEY: ${ANTHROPIC_API_KEY}
                                                                                                                                    WASSENGER_API_KEY: ${WASSENGER_API_KEY}
                                                                                                                                        volumes:
                                                                                                                                              - ./src:/app/src
                                                                                                                                                    - ./config:/app/config
                                                                                                                                                        command: python src/main.py
                                                                                                                                                        
                                                                                                                                                        volumes:
                                                                                                                                                          chroma_data:
